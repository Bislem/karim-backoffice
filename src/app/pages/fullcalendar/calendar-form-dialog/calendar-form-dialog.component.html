<div class="px-4 py-4">
  <h4 class="mat-headline-6 m-b-16">{{action === 'add' ? 'Ajouter une Réservation' : 'Mettre à jour une Réservation'}}
  </h4>

  <mat-stepper #stepper>
    <mat-step [stepControl]="reservationForm.controls['step1']">
      <form [formGroup]="reservationForm" class="col">
        <ng-container formGroupName="step1">
          <ng-template matStepLabel>Ajouter un empreint</ng-template>
          <div>
            <!-- input -->
            <mat-label class="mat-subtitle-2 f-w-600 m-b-8 d-block">Nom du projet</mat-label>
            <mat-form-field appearance="outline" class="w-100">
              <input formControlName="projectName" type="text" matInput />
            </mat-form-field>
          </div>
          <div>
            <!-- input -->
            <mat-label class="mat-subtitle-2 f-w-600 m-b-8 d-block">Lieu</mat-label>
            <mat-form-field appearance="outline" class="w-100">
              <input formControlName="place" type="text" matInput />
            </mat-form-field>
          </div>
          <div>
            <mat-label class="font-bold">Début</mat-label>
            <mat-form-field appearance="outline" placeholder="Acheté le" class="w-100">
              <input formControlName="startDate" matInput [matDatepicker]="picker" />
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>
          <div>
            <mat-label class="font-bold">Fin</mat-label>
            <mat-form-field appearance="outline" placeholder="Acheté le" class="w-100">
              <input formControlName="endDate" matInput [matDatepicker]="picker2" />
              <mat-datepicker-toggle matIconSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
            </mat-form-field>
          </div>

          <div class="flex flex-row w-full">
            <div class="ml-auto">
              <button mat-flat-button matStepperNext [color]="'primary'"
                [disabled]="reservationForm.get('step1')?.invalid">Suivant</button>
            </div>
          </div>
        </ng-container>

      </form>
    </mat-step>
    <mat-step [stepControl]="reservationForm.controls['step2']" label="Choisir le matriel"
      [ariaDisabled]="reservationForm.get('step1')?.invalid">
      <!-- filter  -->
      <div class="w-full flex flex-row">
        <!-- category filter  -->
        <div class="w-fit">
          <mat-form-field appearance="outline" class="w-100">
            <mat-select (valueChange)="applayFilterByCategory($event)" value="" placeholder="Catégorie">
              <mat-option value="">Tout</mat-option>
              <mat-option value="son">SON</mat-option>
              <mat-option value="lumiere">LUMIÈRE</mat-option>
              <mat-option value="image">IMAGE</mat-option>
              <mat-option value="moniteur">MONITEUR</mat-option>
              <mat-option value="trepieds">TREPIEDS</mat-option>
              <mat-option value="machinerie">MACHINERIE</mat-option>
              <mat-option value="autres">AUTRES</mat-option>
            </mat-select>
            <mat-icon matPrefix>
              <i-tabler name="category" class="icon-20 d-flex"></i-tabler>
            </mat-icon>
          </mat-form-field>
        </div>

        <div class="flex-1"></div>

        <!-- search input -->
        <div>
          <mat-form-field appearance="outline" class="w-fit hide-hint">
            <input matInput placeholder="chercher un produit" (keyup)="applyFilter($any($event.target).value)" />
            <mat-icon matSuffix>
              <i-tabler name="search" class="icon-20"></i-tabler>
            </mat-icon>
          </mat-form-field>
        </div>


      </div>
      <div class="h-[40vh] overflow-y-auto overflow-x-hidden">
        <div class="flex flex-col w-full flex-nowrap h-fit">
          <div *ngFor="let productcard of products">
            <div
              class="w-full p-3 mb-4 !h-20 border border-primary-100 overflow-hidden relative flex flex-row shadow rounded-xl"
              *ngIf="$any(productcard).filtred === true || $any(productcard).filtred === undefined">
              <!-- image  -->
              <div class="h-full w-auto relative">
                <span class="m-l-auto transition-all ease-in-out absolute bottom-0 right-0" matTooltip="Prix location">
                  <span class="bg-primary text-white p-x-8 p-y-4 f-w-500 rounded f-s-17">{{productcard.price}}</span>
                </span>
                <img
                  src="{{productcard.images && productcard.images.length > 0 ? getPoster(productcard.images) : '/assets/images/image.png'}}"
                  alt="imgSrc" class="h-full w-auto" />
              </div>

              <!-- product details  -->
              <div class="flex flex-col flex-1 ml-2">
                <h2 class="text-lg text-slate-700 font-bold">{{productcard.name}}</h2>
                <p class="text-slate-500 text-[11px] leading-[11px]">{{productcard.description | slice:0:140}}
                  {{productcard.description && productcard.description.length > 140 ? '...' : ''}}</p>
              </div>

              <!-- selector  -->
              <div class="flex flex-col items-center justify-center">
                <div class="flex flex-row items-center justify-center">
                  <button mat-mini-fab color="primary" (click)="updateQte(productcard,-1)" class="h-7 w-7 text-sm">
                    <mat-icon name="remove" class="">remove</mat-icon>
                  </button>
                  <p class="border-primary border px-2 mx-1 rounded text-lg font-semibold text-center">
                    {{productcard.selectedQte}}
                    <span class="text-[11px] text-primary">
                      /{{productcard.quantity}}
                    </span>
                  </p>
                  <button mat-mini-fab color="primary" (click)="updateQte(productcard,1)" class="h-7 w-7 text-sm">
                    <mat-icon name="add" class="">add</mat-icon>
                  </button>
                </div>
              </div>

            </div>
          </div>

        </div>
      </div>
      <div class="flex flex-row w-full">
        <div class="ml-auto">
          <button mat-flat-button matStepperPrevious class="text-white mr-2" [color]="'warn'">retour</button>
          <button mat-flat-button matStepperNext [color]="'primary'">suivant</button>
        </div>
      </div>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Confirmation</ng-template>
      <div class="flex flex-col">
        <!-- general details  -->
        <div class="flex flex-row w-full">
          <!-- date  -->
          <div class="flex flex-col flex-1 border-r border-r-slate-400">
            <span class="p-3"><strong class="text-lg text-slate-600">Du</strong> <br>
              {{reservationForm.controls['step1'].get('startDate')?.value | date: 'dd/MM/YYYY'}}</span>
            <span class="p-3"><strong class="text-lg text-slate-600">Au</strong> <br>
              {{reservationForm.controls['step1'].get('endDate')?.value | date: 'dd/MM/YYYY'}}</span>
          </div>

          <!-- title and place  -->
          <div class="flex flex-col flex-1 pl-12">
            <span class="p-3"><strong class="text-lg text-slate-600">Titre</strong> <br>
              {{reservationForm.controls['step1'].get('projectName')?.value}}</span>
            <span class="p-3"><strong class="text-lg text-slate-600">Lieu</strong> <br>
              {{reservationForm.controls['step1'].get('place')?.value}}</span>
          </div>
        </div>

        <!-- products  -->
        <div class="h-[30vh] overflow-y-auto overflow-x-hidden">
          <div class="flex flex-col w-full flex-nowrap h-fit">
            <div *ngFor="let productcard of products">
              <div
                class="w-full p-3 mb-4 !h-20 border border-primary-100 overflow-hidden relative flex flex-row shadow rounded-xl"
                *ngIf="$any(productcard).selectedQte > 0">
                <!-- image  -->
                <div class="h-full w-auto relative">
                  <span class="m-l-auto transition-all ease-in-out absolute bottom-0 right-0"
                    matTooltip="Prix location">
                    <span class="bg-primary text-white p-x-8 p-y-4 f-w-500 rounded f-s-17">{{productcard.price}}</span>
                  </span>
                  <img
                    src="{{productcard.images && productcard.images.length > 0 ? getPoster(productcard.images) : '/assets/images/image.png'}}"
                    alt="imgSrc" class="h-full w-auto" />
                </div>

                <!-- product details  -->
                <div class="flex flex-col flex-1 ml-2">
                  <h2 class="text-lg text-slate-700 font-bold">{{productcard.name}}</h2>
                  <p class="text-slate-500 text-[11px] leading-[11px]">{{productcard.description | slice:0:140}}
                    {{productcard.description.length > 140 ? '...' : ''}}</p>
                </div>

                <!-- selector  -->
                <div class="flex flex-col items-center justify-center">
                  <div class="flex flex-row items-center justify-center">
                    <p class="border-primary border px-2 mx-1 rounded text-lg font-semibold text-center">

                      <span class="text-2xl text-primary">
                        × {{productcard.selectedQte}} =
                      </span>
                      {{$any(productcard.selectedQte) * productcard.price}}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div>
          <div
            class="w-full p-3 mb-4 !h-20 border border-primary-100 overflow-hidden relative flex flex-row shadow rounded-xl">
            <!-- product details  -->
            <div class="flex flex-col flex-1 ml-2">
              <h2 class="text-lg text-primary font-bold">Total</h2>
            </div>

            <!-- selector  -->
            <div class="flex flex-col items-center justify-center">
              <div class="flex flex-row items-center justify-center">
                <p class="border-primary border px-2 mx-1 rounded text-lg font-semibold text-center">

                  <span class="text-2xl text-primary">
                    = {{total}}
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>


      </div>


      <div class="flex flex-row w-full">
        <div class="ml-auto">
          <button mat-flat-button matStepperPrevious class="text-white mr-2" [color]="'warn'">retour</button>
          <button mat-flat-button (click)="submitForm()" [color]="'primary'">Valider</button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</div>